modbus_controller:
  - id: ${aio_id}
    address: ${aio_address}
    modbus_id: modbus_bus
    update_interval: 2s        # was 1s
    command_throttle: 10ms     # add a small gap between frames
    setup_priority: -10.0      # start after UART/modbus is ready
# ------------- Discrete Inputs (LEDs + RTD faults only) -------------
binary_sensor:
  # MAX31865 fault flags 360..361
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    name: "${aio_prefix} RTD1 Fault"
    address: 360
    register_type: discrete_input

# ------------- Numbers (Holding Registers: DAC raw only) -------------
number:
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    name: "${aio_prefix} DAC1 Raw"
    address: 211
    register_type: holding
    value_type: U_WORD
    min_value: 0
    max_value: 4095
    step: 1
    mode: slider
    unit_of_measurement: "code"

# ---------------- Sensors (Input Registers: AI/RTD/DAC mV) ----------------
sensor:
  # ADS1115 — field mV (U_WORD) @ 120..123
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    id: ch0_mv
    name: "${aio_prefix} CH0 mV"
    address: 120
    register_type: read
    value_type: U_WORD
    unit_of_measurement: "mV"
    accuracy_decimals: 0
  # ADS1115 — raw counts (S_WORD) @ 100..103
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    id: ch0_raw
    name: "${aio_prefix} CH0 raw"
    address: 100
    register_type: read
    value_type: S_WORD
    unit_of_measurement: "cnt"
    accuracy_decimals: 0
  # MAX31865 — °C x100 (S_WORD) @ 140..141
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    id: rtd1_cx100
    name: "${aio_prefix} RTD1 Temperature"
    address: 140
    register_type: read
    value_type: S_WORD
    unit_of_measurement: "°C"
    accuracy_decimals: 2
    filters: [{ multiply: 0.01 }]

  # MAX31865 — Ohm x100 (U_WORD) @ 150..151
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    id: rtd1_ohmx100
    name: "${aio_prefix} RTD1 Resistance"
    address: 150
    register_type: read
    value_type: U_WORD
    unit_of_measurement: "Ω"
    accuracy_decimals: 2
    filters: [{ multiply: 0.01 }]

  # DAC field outputs (mV) @ 180..181
  - platform: modbus_controller
    modbus_controller_id: ${aio_id}
    id: ao1_mv
    name: "${aio_prefix} AO1 mV"
    address: 181
    register_type: read
    value_type: U_WORD
    unit_of_measurement: "mV"
    accuracy_decimals: 0
