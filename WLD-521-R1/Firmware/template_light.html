<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WLD-521-R1 Module Configuration</title>

<style>
:root{
  --page:#ffffff;
  --card:#ffffff;

  --text:#0f172a;
  --muted:#475569;
  --muted2:#64748b;

  --border:#e2e8f0;
  --borderStrong:#cbd5e1;

  --brand:#2563eb;
  --brandHover:#1d4ed8;

  --ok:#16a34a;
  --warn:#f59e0b;
  --bad:#ef4444;

  --shadow:0 1px 0 rgba(15,23,42,.05),
           0 10px 22px rgba(15,23,42,.08);

  --r:16px;
  --r2:14px;
  --gap:16px;

  --font:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;

  /* ===== Original WebConfig group tints ===== */
  --tint-input-bg:#e9fbe9;
  --tint-input-br:#bfe7bf;

  --tint-button-bg:#dbe9ff;
  --tint-button-br:#b7cffc;

  --tint-led-bg:#f6f8d6;
  --tint-led-br:#e2e79e;

  --tint-relay-bg:#eef2ff;
  --tint-relay-br:#c7d2fe;

  --tint-1w-bg:#f1f5f9;
  --tint-1w-br:#e2e8f0;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--page);
  color:var(--text);
  font-family:var(--font);
}

.container{
  max-width:1160px;
  margin:22px auto 32px;
  padding:0 16px;
}

/* ===== Header ===== */
.appbar{
  display:flex;
  justify-content:space-between;
  gap:16px;
  padding:16px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--r);
  box-shadow:var(--shadow);
}

.headLeft{
  display:flex;
  gap:14px;
  align-items:center;
  min-width:300px;
}

.moduleImage{
  width:64px;
  height:64px;
  border-radius:14px;
  border:1px solid var(--border);
  display:grid;
  place-items:center;
  overflow:hidden;
  background:#fff;
}

.moduleImage img{
  width:100%;
  height:100%;
  object-fit:contain;
}

.moduleFallback{
  width:100%;
  height:100%;
  display:grid;
  place-items:center;
  color:#94a3b8;
}

.title h1{
  margin:0;
  font-size:18px;
  font-weight:800;
}
.title p{
  margin:4px 0 0;
  font-size:13px;
  color:var(--muted);
}

/* Status pills */
.statusbar{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:10px;
}
.pillrow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.pill{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  font-size:12px;
  font-weight:650;
  color:var(--muted);
  border:1px solid var(--border);
  border-radius:999px;
  background:#fff;
}
.dot{
  width:8px;height:8px;border-radius:50%;
  background:#cbd5e1;
}
.dot.ok{background:var(--ok)}
.dot.warn{background:var(--warn)}
.dot.bad{background:var(--bad)}

.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}

.btn{
  padding:8px 14px;
  font-size:13px;
  font-weight:750;
  border-radius:12px;
  border:1px solid var(--borderStrong);
  background:#fff;
  cursor:pointer;
  transition:background .12s ease, border-color .12s ease, transform .05s ease;
}
.btn:active{ transform:translateY(1px); }
.btn.primary{
  background:var(--brand);
  color:#fff;
  border-color:var(--brand);
}
.btn.primary:hover{background:var(--brandHover)}
.btn.danger{
  color:var(--bad);
  border-color:#fecaca;
}
.btn.danger:hover{background:rgba(239,68,68,.06)}
.btn.secondary{
  color:var(--text);
  border-color:var(--borderStrong);
  background:#f8fafc;
}
.btn.secondary:hover{background:#f1f5f9}
.btn.small{
  padding:6px 10px;
  font-size:12px;
  border-radius:10px;
}

/* ===== Layout ===== */
.grid{
  display:grid;
  gap:var(--gap);
  margin-top:16px;
}
.grid.two{
  grid-template-columns:1.2fr .8fr;
}
@media(max-width:980px){
  .grid.two{grid-template-columns:1fr}
  .statusbar{align-items:flex-start}
  .pillrow,.actions{justify-content:flex-start}
}

/* ===== Cards ===== */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--r);
  box-shadow:var(--shadow);
}
.cardheader{
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
}
.cardheader h2{
  margin:0;
  font-size:14px;
  font-weight:850;
}
.sub{
  margin-top:4px;
  font-size:12px;
  color:var(--muted);
}
.tag{
  font-size:11px;
  font-weight:750;
  color:#0f172a;
  border:1px solid var(--border);
  background:#f8fafc;
  padding:3px 8px;
  border-radius:999px;
  white-space:nowrap;
}
.cardbody{padding:14px}

/* ===== Forms ===== */
label{
  display:block;
  font-size:12px;
  font-weight:750;
  color:var(--muted);
  margin-bottom:6px;
}
input,select,textarea{
  width:100%;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--borderStrong);
  font-size:13px;
  color:var(--text);
  background:#fff;
}
input:focus,select:focus,textarea:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(37,99,235,.15);
}
textarea{
  min-height:140px;
  font-family:ui-monospace,Consolas,monospace;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:var(--gap);
}
@media(max-width:640px){ .row{grid-template-columns:1fr} }

.mini{
  margin-top:8px;
  font-size:12px;
  color:var(--muted2);
}
.mini strong{ color:var(--text); }

/* ===== Section titles ===== */
.sectiontitle{
  margin:18px 0 10px;
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  gap:12px;
}
.sectiontitle h3{
  margin:0;
  font-size:14px;
  font-weight:900;
}
.sectiontitle .hint{
  margin:0;
  font-size:12px;
  color:var(--muted2);
  font-weight:650;
}

/* ===== IO grids ===== */
.iogroup{
  display:grid;
  gap:var(--gap);
  grid-template-columns:repeat(4,1fr);
}
@media(max-width:1100px){ .iogroup{grid-template-columns:repeat(2,1fr)} }
@media(max-width:640px){ .iogroup{grid-template-columns:1fr} }

.iocard{
  border:1px solid var(--border);
  border-radius:var(--r2);
  padding:12px;
  background:#fff;
  position:relative;
  overflow:hidden;
}

/* subtle “header strip” like original */
.iocard::before{
  content:"";
  position:absolute;
  left:0; top:0; right:0;
  height:42px;
  background: rgba(255,255,255,.55);
  border-bottom: 1px solid rgba(15,23,42,.06);
  pointer-events:none;
}
.iotop{ position:relative; z-index:1; }
.iocard > *:not(.iotop){ position:relative; z-index:1; }

.iotop{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.ioid{
  font-size:14px;
  font-weight:900;
}

.ioBadge{
  font-size:11px;
  font-weight:750;
  border:1px solid var(--border);
  padding:3px 8px;
  border-radius:999px;
  background:#f8fafc;
}

.checkRow{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-bottom:10px;
}

.check{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:12px;
  font-weight:700;
  color:var(--text);
}
.check input{width:auto}

.split{
  display:grid;
  gap:10px;
}

.cols3{ grid-template-columns:repeat(3,1fr); }
@media(max-width:1100px){ .cols3{grid-template-columns:repeat(2,1fr)} }
@media(max-width:640px){ .cols3{grid-template-columns:1fr} }

.cols2{ grid-template-columns:repeat(2,1fr); }
@media(max-width:640px){ .cols2{grid-template-columns:1fr} }

/* ===== Group tints ===== */
.tint-input{ background:var(--tint-input-bg); border-color:var(--tint-input-br); }
.tint-button{ background:var(--tint-button-bg); border-color:var(--tint-button-br); }
.tint-led{ background:var(--tint-led-bg); border-color:var(--tint-led-br); }
.tint-relay{ background:var(--tint-relay-bg); border-color:var(--tint-relay-br); }
.tint-1w{ background:var(--tint-1w-bg); border-color:var(--tint-1w-br); }

.iocard.tint-input::before,
.iocard.tint-button::before,
.iocard.tint-led::before,
.iocard.tint-relay::before,
.iocard.tint-1w::before{
  background: rgba(255,255,255,.50);
}

/* Controls look consistent on tinted cards */
.iocard select,
.iocard input,
.iocard textarea{
  background: rgba(255,255,255,.92);
}

/* ===== Tables ===== */
.tableWrap{
  border:1px solid var(--border);
  border-radius:14px;
  overflow:hidden;
  background:#fff;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
thead th{
  text-align:left;
  background:#f8fafc;
  color:var(--muted);
  font-weight:800;
  padding:10px 12px;
  border-bottom:1px solid var(--border);
}
tbody td{
  padding:10px 12px;
  border-bottom:1px solid var(--border);
}
tbody tr:last-child td{ border-bottom:none; }
td.mono{ font-family:ui-monospace,Consolas,monospace; font-size:12px; }
td.center{ text-align:center; }
.badgeState{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-weight:750;
  color:var(--muted);
}
.badgeState .dot{ width:9px;height:9px; }
</style>
</head>

<body>
<div class="container">

  <!-- Header -->
  <header class="appbar">
    <div class="headLeft">
      <div class="moduleImage">
        <!-- Replace src with your WLD-521-R1 product image when available -->
        <img id="moduleImg" src="" alt="WLD-521-R1 module" style="display:none;">
        <div class="moduleFallback" id="moduleFallback" aria-hidden="true">
          <svg width="34" height="34" viewBox="0 0 24 24" fill="none">
            <path d="M4 7a3 3 0 0 1 3-3h10a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7Z" stroke="currentColor" stroke-width="1.8"/>
            <path d="M8 10h8M8 14h8" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
          </svg>
        </div>
      </div>

      <div class="title">
        <h1>WLD-521-R1 Module Configuration</h1>
        <p>Modbus, Inputs (5), Relays (2), 1-Wire — Flow &amp; Heat Energy.</p>
      </div>
    </div>

    <div class="statusbar">
      <div class="pillrow">
        <div class="pill"><span class="dot warn" id="connDot"></span>Connection: <span id="connText" style="color:var(--text)">Disconnected</span></div>
        <div class="pill">Modbus ID: <span id="activeId" style="color:var(--text)">—</span></div>
        <div class="pill">Baud: <span id="activeBaud" style="color:var(--text)">—</span></div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnConnect" type="button">Connect</button>
        <button class="btn danger" id="btnReset" type="button">Reset Device</button>
      </div>
    </div>
  </header>

  <!-- Top: Device Setup + Log -->
  <div class="grid two">
    <section class="card">
      <div class="cardheader">
        <div>
          <h2>Device Setup</h2>
          <div class="sub">Serial connection and Modbus addressing.</div>
        </div>
        <span class="tag">Step 1</span>
      </div>
      <div class="cardbody">
        <div class="row">
          <div>
            <label for="modbusAddress">Modbus Address</label>
            <select id="modbusAddress">
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3" selected>3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
            <div class="mini">Use a unique address per device on the bus.</div>
          </div>

          <div>
            <label for="baudRate">Baud Rate</label>
            <select id="baudRate">
              <option value="9600">9600</option>
              <option value="19200" selected>19200</option>
              <option value="38400">38400</option>
              <option value="57600">57600</option>
              <option value="115200">115200</option>
            </select>
            <div class="mini">Must match your controller UART settings.</div>
          </div>
        </div>

        <div class="mini" style="margin-top:10px;font-weight:650;">
          Tip: Connect first, then configure 1-Wire, inputs, relays, LEDs, and buttons.
        </div>
      </div>
    </section>

    <section class="card">
      <div class="cardheader">
        <div>
          <h2>Serial Log</h2>
          <div class="sub">Connection messages and device responses.</div>
        </div>
        <span class="tag">Live</span>
      </div>
      <div class="cardbody">
        <label for="serialLog">Log</label>
        <textarea id="serialLog" readonly placeholder="Log output will appear here..."></textarea>
      </div>
    </section>
  </div>

  <!-- 1-Wire -->
  <div class="sectiontitle">
    <h3>1-Wire (GPIO16) Devices</h3>
    <p class="hint">Scan bus, review discovered devices, then store sensors to flash.</p>
  </div>

  <section class="card">
    <div class="cardbody">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px;">
        <button class="btn secondary small" id="btnScan1W" type="button">Scan 1-Wire</button>
        <span class="mini" id="scanState" style="margin:0;">Not scanned yet.</span>
      </div>

      <div class="row" style="align-items:start;">
        <div class="iocard tint-1w">
          <div class="iotop"><span class="ioid">Discovered devices</span><span class="ioBadge">Bus</span></div>
          <label for="onewireDiscovered">List</label>
          <input id="onewireDiscovered" readonly placeholder='Click "Scan 1-Wire" to list devices.'>
        </div>

        <div class="iocard tint-1w">
          <div class="iotop"><span class="ioid">Stored sensors (flash)</span><span class="ioBadge">Flash</span></div>
          <label for="onewireStored">List</label>
          <input id="onewireStored" readonly placeholder="Waiting for device list...">
        </div>
      </div>

      <div style="margin-top:14px;display:flex;justify-content:space-between;align-items:baseline;gap:12px;">
        <div style="font-size:13px;font-weight:900;">1-Wire Live Temperatures</div>
        <div class="mini" style="margin:0;">Auto-refreshes from device (if supported).</div>
      </div>

      <div class="tableWrap" style="margin-top:10px;">
        <table>
          <thead>
            <tr>
              <th style="width:60px;">#</th>
              <th>Address</th>
              <th>Name</th>
              <th style="width:120px;">Temp (°C)</th>
              <th style="width:140px;">Errors</th>
            </tr>
          </thead>
          <tbody id="tempTableBody">
            <tr>
              <td class="mono">—</td>
              <td class="mono" colspan="4" style="color:var(--muted2);">Waiting for data…</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mini" style="margin-top:10px;">
        Tip: Use 1-Wire sensors for temperature inputs (heat/energy metering logic).
      </div>
    </div>
  </section>

  <!-- Digital Inputs -->
  <div class="sectiontitle">
    <h3>Digital Inputs (5)</h3>
    <p class="hint">Enable, invert logic, choose type, then select action/target if applicable.</p>
  </div>

  <section class="card">
    <div class="cardbody">
      <div class="iogroup">
        <!-- IN1 -->
        <div class="iocard tint-input">
          <div class="iotop"><span class="ioid">IN1</span><span class="ioBadge">Input</span></div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="in1Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="in1Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="in1Type">Type</label>
              <select id="in1Type">
                <option value="water_sensor" selected>Water sensor</option>
                <option value="water_counter">Water counter</option>
                <option value="dry_contact">Dry contact</option>
              </select>
            </div>
            <div class="row" style="grid-template-columns:1fr 1fr;">
              <div>
                <label for="in1Action">Action</label>
                <select id="in1Action">
                  <option value="none" selected>None</option>
                  <option value="toggle_relay">Toggle Relay</option>
                  <option value="pulse_relay">Pulse Relay</option>
                  <option value="alarm">Alarm</option>
                </select>
              </div>
              <div>
                <label for="in1Target">Control target</label>
                <select id="in1Target">
                  <option value="none" selected>None</option>
                  <option value="relay1">Relay 1</option>
                  <option value="relay2">Relay 2</option>
                  <option value="all_relays">All relays</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mini">For <strong>Water counter</strong>, action/target are ignored; input counts rising edges.</div>
        </div>

        <!-- IN2 -->
        <div class="iocard tint-input">
          <div class="iotop"><span class="ioid">IN2</span><span class="ioBadge">Input</span></div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="in2Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="in2Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="in2Type">Type</label>
              <select id="in2Type">
                <option value="water_sensor" selected>Water sensor</option>
                <option value="water_counter">Water counter</option>
                <option value="dry_contact">Dry contact</option>
              </select>
            </div>
            <div class="row" style="grid-template-columns:1fr 1fr;">
              <div>
                <label for="in2Action">Action</label>
                <select id="in2Action">
                  <option value="none" selected>None</option>
                  <option value="toggle_relay">Toggle Relay</option>
                  <option value="pulse_relay">Pulse Relay</option>
                  <option value="alarm">Alarm</option>
                </select>
              </div>
              <div>
                <label for="in2Target">Control target</label>
                <select id="in2Target">
                  <option value="none" selected>None</option>
                  <option value="relay1">Relay 1</option>
                  <option value="relay2">Relay 2</option>
                  <option value="all_relays">All relays</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mini">For <strong>Water counter</strong>, action/target are ignored; input counts rising edges.</div>
        </div>

        <!-- IN3 -->
        <div class="iocard tint-input">
          <div class="iotop"><span class="ioid">IN3</span><span class="ioBadge">Input</span></div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="in3Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="in3Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="in3Type">Type</label>
              <select id="in3Type">
                <option value="water_sensor" selected>Water sensor</option>
                <option value="water_counter">Water counter</option>
                <option value="dry_contact">Dry contact</option>
              </select>
            </div>
            <div class="row" style="grid-template-columns:1fr 1fr;">
              <div>
                <label for="in3Action">Action</label>
                <select id="in3Action">
                  <option value="none" selected>None</option>
                  <option value="toggle_relay">Toggle Relay</option>
                  <option value="pulse_relay">Pulse Relay</option>
                  <option value="alarm">Alarm</option>
                </select>
              </div>
              <div>
                <label for="in3Target">Control target</label>
                <select id="in3Target">
                  <option value="none" selected>None</option>
                  <option value="relay1">Relay 1</option>
                  <option value="relay2">Relay 2</option>
                  <option value="all_relays">All relays</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mini">For <strong>Water counter</strong>, action/target are ignored; input counts rising edges.</div>
        </div>

        <!-- IN4 -->
        <div class="iocard tint-input">
          <div class="iotop"><span class="ioid">IN4</span><span class="ioBadge">Input</span></div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="in4Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="in4Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="in4Type">Type</label>
              <select id="in4Type">
                <option value="water_sensor" selected>Water sensor</option>
                <option value="water_counter">Water counter</option>
                <option value="dry_contact">Dry contact</option>
              </select>
            </div>
            <div class="row" style="grid-template-columns:1fr 1fr;">
              <div>
                <label for="in4Action">Action</label>
                <select id="in4Action">
                  <option value="none" selected>None</option>
                  <option value="toggle_relay">Toggle Relay</option>
                  <option value="pulse_relay">Pulse Relay</option>
                  <option value="alarm">Alarm</option>
                </select>
              </div>
              <div>
                <label for="in4Target">Control target</label>
                <select id="in4Target">
                  <option value="none" selected>None</option>
                  <option value="relay1">Relay 1</option>
                  <option value="relay2">Relay 2</option>
                  <option value="all_relays">All relays</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mini">For <strong>Water counter</strong>, action/target are ignored; input counts rising edges.</div>
        </div>

        <!-- IN5 -->
        <div class="iocard tint-input">
          <div class="iotop"><span class="ioid">IN5</span><span class="ioBadge">Input</span></div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="in5Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="in5Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="in5Type">Type</label>
              <select id="in5Type">
                <option value="water_sensor" selected>Water sensor</option>
                <option value="water_counter">Water counter</option>
                <option value="dry_contact">Dry contact</option>
              </select>
            </div>
            <div class="row" style="grid-template-columns:1fr 1fr;">
              <div>
                <label for="in5Action">Action</label>
                <select id="in5Action">
                  <option value="none" selected>None</option>
                  <option value="toggle_relay">Toggle Relay</option>
                  <option value="pulse_relay">Pulse Relay</option>
                  <option value="alarm">Alarm</option>
                </select>
              </div>
              <div>
                <label for="in5Target">Control target</label>
                <select id="in5Target">
                  <option value="none" selected>None</option>
                  <option value="relay1">Relay 1</option>
                  <option value="relay2">Relay 2</option>
                  <option value="all_relays">All relays</option>
                </select>
              </div>
            </div>
          </div>
          <div class="mini">For <strong>Water counter</strong>, action/target are ignored; input counts rising edges.</div>
        </div>

      </div>
    </div>
  </section>

  <!-- Relays -->
  <div class="sectiontitle">
    <h3>Relays (2)</h3>
    <p class="hint">Enable each relay and choose control mode / inversion.</p>
  </div>

  <section class="card">
    <div class="cardbody">
      <div class="iogroup cols2">

        <div class="iocard tint-relay">
          <div class="iotop">
            <span class="ioid">Relay 1</span>
            <span class="badgeState"><span class="dot ok" id="r1Dot"></span><span id="r1State">ON</span></span>
          </div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="r1Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="r1Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="r1Mode">Control mode</label>
              <select id="r1Mode">
                <option value="local" selected>Local</option>
                <option value="modbus">Modbus</option>
                <option value="mixed">Mixed</option>
              </select>
            </div>
            <div>
              <label for="r1Override">Override state</label>
              <select id="r1Override">
                <option value="none" selected>—</option>
                <option value="force_on">Force ON</option>
                <option value="force_off">Force OFF</option>
              </select>
            </div>
          </div>
        </div>

        <div class="iocard tint-relay">
          <div class="iotop">
            <span class="ioid">Relay 2</span>
            <span class="badgeState"><span class="dot ok" id="r2Dot"></span><span id="r2State">ON</span></span>
          </div>
          <div class="checkRow">
            <label class="check"><input type="checkbox" id="r2Enabled" checked> Enabled</label>
            <label class="check"><input type="checkbox" id="r2Inverted"> Inverted</label>
          </div>
          <div class="split">
            <div>
              <label for="r2Mode">Control mode</label>
              <select id="r2Mode">
                <option value="local" selected>Local</option>
                <option value="modbus">Modbus</option>
                <option value="mixed">Mixed</option>
              </select>
            </div>
            <div>
              <label for="r2Override">Override state</label>
              <select id="r2Override">
                <option value="none" selected>—</option>
                <option value="force_on">Force ON</option>
                <option value="force_off">Force OFF</option>
              </select>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Buttons -->
  <div class="sectiontitle">
    <h3>Buttons (4)</h3>
    <p class="hint">Assign local actions (toggle/pulse/override).</p>
  </div>

  <section class="card">
    <div class="cardbody">
      <div class="iogroup">

        <div class="iocard tint-button">
          <div class="iotop">
            <span class="ioid">BTN 1</span>
            <span class="badgeState"><span class="dot" id="b1Dot"></span><span id="b1State">Released</span></span>
          </div>
          <div>
            <label for="b1Action">Action</label>
            <select id="b1Action">
              <option value="none" selected>(none)</option>
              <option value="r1_toggle">Relay 1 toggle</option>
              <option value="r2_toggle">Relay 2 toggle</option>
              <option value="r1_pulse">Relay 1 pulse</option>
              <option value="r2_pulse">Relay 2 pulse</option>
              <option value="override_toggle">Override toggle</option>
            </select>
          </div>
        </div>

        <div class="iocard tint-button">
          <div class="iotop">
            <span class="ioid">BTN 2</span>
            <span class="badgeState"><span class="dot" id="b2Dot"></span><span id="b2State">Released</span></span>
          </div>
          <div>
            <label for="b2Action">Action</label>
            <select id="b2Action">
              <option value="none" selected>(none)</option>
              <option value="r1_toggle">Relay 1 toggle</option>
              <option value="r2_toggle">Relay 2 toggle</option>
              <option value="r1_pulse">Relay 1 pulse</option>
              <option value="r2_pulse">Relay 2 pulse</option>
              <option value="override_toggle">Override toggle</option>
            </select>
          </div>
        </div>

        <div class="iocard tint-button">
          <div class="iotop">
            <span class="ioid">BTN 3</span>
            <span class="badgeState"><span class="dot" id="b3Dot"></span><span id="b3State">Released</span></span>
          </div>
          <div>
            <label for="b3Action">Action</label>
            <select id="b3Action">
              <option value="none" selected>(none)</option>
              <option value="r1_toggle">Relay 1 toggle</option>
              <option value="r2_toggle">Relay 2 toggle</option>
              <option value="r1_pulse">Relay 1 pulse</option>
              <option value="r2_pulse">Relay 2 pulse</option>
              <option value="override_toggle">Override toggle</option>
            </select>
          </div>
        </div>

        <div class="iocard tint-button">
          <div class="iotop">
            <span class="ioid">BTN 4</span>
            <span class="badgeState"><span class="dot" id="b4Dot"></span><span id="b4State">Released</span></span>
          </div>
          <div>
            <label for="b4Action">Action</label>
            <select id="b4Action">
              <option value="none" selected>(none)</option>
              <option value="r1_toggle">Relay 1 toggle</option>
              <option value="r2_toggle">Relay 2 toggle</option>
              <option value="r1_pulse">Relay 1 pulse</option>
              <option value="r2_pulse">Relay 2 pulse</option>
              <option value="override_toggle">Override toggle</option>
            </select>
          </div>
          <div class="mini">Actions: Toggle/Pulse relays, or override toggle (short/long press per firmware).</div>
        </div>

      </div>
    </div>
  </section>

  <!-- LEDs -->
  <div class="sectiontitle">
    <h3>LEDs (4)</h3>
    <p class="hint">Set mode and source; state reflects current device status.</p>
  </div>

  <section class="card">
    <div class="cardbody">
      <div class="iogroup">

        <div class="iocard tint-led">
          <div class="iotop">
            <span class="ioid">LED 1</span>
            <span class="badgeState"><span class="dot ok" id="l1Dot"></span><span id="l1State">On</span></span>
          </div>
          <div class="split">
            <div>
              <label for="l1Mode">Mode</label>
              <select id="l1Mode">
                <option value="solid" selected>Solid</option>
                <option value="blink_1hz">Blink (1Hz)</option>
                <option value="blink_2hz">Blink (2Hz)</option>
                <option value="off">Off</option>
              </select>
            </div>
            <div>
              <label for="l1Source">Source</label>
              <select id="l1Source">
                <option value="none" selected>(none)</option>
                <option value="r1">Relay 1</option>
                <option value="r2">Relay 2</option>
                <option value="in1">IN1</option>
                <option value="in2">IN2</option>
                <option value="in3">IN3</option>
                <option value="in4">IN4</option>
                <option value="in5">IN5</option>
                <option value="override">Override</option>
              </select>
            </div>
          </div>
        </div>

        <div class="iocard tint-led">
          <div class="iotop">
            <span class="ioid">LED 2</span>
            <span class="badgeState"><span class="dot ok" id="l2Dot"></span><span id="l2State">On</span></span>
          </div>
          <div class="split">
            <div>
              <label for="l2Mode">Mode</label>
              <select id="l2Mode">
                <option value="solid" selected>Solid</option>
                <option value="blink_1hz">Blink (1Hz)</option>
                <option value="blink_2hz">Blink (2Hz)</option>
                <option value="off">Off</option>
              </select>
            </div>
            <div>
              <label for="l2Source">Source</label>
              <select id="l2Source">
                <option value="none" selected>(none)</option>
                <option value="r1">Relay 1</option>
                <option value="r2">Relay 2</option>
                <option value="in1">IN1</option>
                <option value="in2">IN2</option>
                <option value="in3">IN3</option>
                <option value="in4">IN4</option>
                <option value="in5">IN5</option>
                <option value="override">Override</option>
              </select>
            </div>
          </div>
        </div>

        <div class="iocard tint-led">
          <div class="iotop">
            <span class="ioid">LED 3</span>
            <span class="badgeState"><span class="dot ok" id="l3Dot"></span><span id="l3State">On</span></span>
          </div>
          <div class="split">
            <div>
              <label for="l3Mode">Mode</label>
              <select id="l3Mode">
                <option value="solid" selected>Solid</option>
                <option value="blink_1hz">Blink (1Hz)</option>
                <option value="blink_2hz">Blink (2Hz)</option>
                <option value="off">Off</option>
              </select>
            </div>
            <div>
              <label for="l3Source">Source</label>
              <select id="l3Source">
                <option value="none" selected>(none)</option>
                <option value="r1">Relay 1</option>
                <option value="r2">Relay 2</option>
                <option value="in1">IN1</option>
                <option value="in2">IN2</option>
                <option value="in3">IN3</option>
                <option value="in4">IN4</option>
                <option value="in5">IN5</option>
                <option value="override">Override</option>
              </select>
            </div>
          </div>
        </div>

        <div class="iocard tint-led">
          <div class="iotop">
            <span class="ioid">LED 4</span>
            <span class="badgeState"><span class="dot ok" id="l4Dot"></span><span id="l4State">On</span></span>
          </div>
          <div class="split">
            <div>
              <label for="l4Mode">Mode</label>
              <select id="l4Mode">
                <option value="solid" selected>Solid</option>
                <option value="blink_1hz">Blink (1Hz)</option>
                <option value="blink_2hz">Blink (2Hz)</option>
                <option value="off">Off</option>
              </select>
            </div>
            <div>
              <label for="l4Source">Source</label>
              <select id="l4Source">
                <option value="none" selected>(none)</option>
                <option value="r1">Relay 1</option>
                <option value="r2">Relay 2</option>
                <option value="in1">IN1</option>
                <option value="in2">IN2</option>
                <option value="in3">IN3</option>
                <option value="in4">IN4</option>
                <option value="in5">IN5</option>
                <option value="override">Override</option>
              </select>
            </div>
          </div>
          <div class="mini">Mode: Solid or Blink when source is active (R1/R2, DI1–DI5, Override).</div>
        </div>

      </div>
    </div>
  </section>

</div>

<script>
/* =========
   Minimal “drop-in” UI behavior placeholders.
   Replace these with your actual WebSerial / Modbus logic.
========= */

function setConnection(isConnected){
  const dot = document.getElementById("connDot");
  const text = document.getElementById("connText");
  dot.classList.remove("ok","warn","bad");
  dot.classList.add(isConnected ? "ok" : "warn");
  text.textContent = isConnected ? "Connected" : "Disconnected";

  document.getElementById("activeId").textContent = document.getElementById("modbusAddress").value || "—";
  document.getElementById("activeBaud").textContent = document.getElementById("baudRate").value || "—";
}

function logLine(s){
  const ta = document.getElementById("serialLog");
  ta.value += (ta.value ? "\n" : "") + s;
  ta.scrollTop = ta.scrollHeight;
}

document.getElementById("btnConnect").addEventListener("click", () => {
  const currentlyConnected = document.getElementById("connText").textContent === "Connected";
  setConnection(!currentlyConnected);
  logLine(!currentlyConnected ? "[OK] Connected (demo)" : "[INFO] Disconnected (demo)");
});

document.getElementById("btnReset").addEventListener("click", () => {
  logLine("[WARN] Reset requested (demo)");
});

document.getElementById("btnScan1W").addEventListener("click", () => {
  document.getElementById("scanState").textContent = "Scanning…";
  logLine("[INFO] 1-Wire scan started (demo)");

  setTimeout(() => {
    document.getElementById("scanState").textContent = "Scan complete.";
    document.getElementById("onewireDiscovered").value = "28-FF-1A-2B-3C-4D-5E-6F, 28-FF-00-11-22-33-44-55";
    document.getElementById("onewireStored").value = "T1 (Boiler), T2 (Return)";

    const tb = document.getElementById("tempTableBody");
    tb.innerHTML = `
      <tr>
        <td class="mono">1</td>
        <td class="mono">28-FF-1A-2B-3C-4D-5E-6F</td>
        <td>Boiler</td>
        <td class="center">56.2</td>
        <td style="color:var(--muted2);">—</td>
      </tr>
      <tr>
        <td class="mono">2</td>
        <td class="mono">28-FF-00-11-22-33-44-55</td>
        <td>Return</td>
        <td class="center">42.8</td>
        <td style="color:var(--muted2);">—</td>
      </tr>
    `;
    logLine("[OK] 1-Wire scan complete (demo)");
  }, 450);
});

// Default state
setConnection(false);
</script>
</body>
</html>
